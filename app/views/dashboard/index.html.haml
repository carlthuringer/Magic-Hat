= render 'layouts/header', :right_button => nil, :left_button => nil
%div{ :data => { :role => 'content' } }
  = render 'layouts/flash', :flash => flash
  - if current_user.goals.count == 0
    #tutorial
      :textile
        Welcome to *Magic Hat*. The next step is to create your first goal.
    = link_to "Add goal", new_goal_path, :data => { :role => "button", :icon => "plus",
      :theme => 'b' }
  - else
    #statistics.ui-corner-all.ui-shadow.ui-btn-up-c
      -# TODO Link this to a 'what is this' FAQ sort of page. Make some method that friendly links 'ok, back to what i was doing'
      %span#stats-grid-plus-minus
        = link_to "+", "#", :id => "expand-stats-grid", 'data-role' => 'button',
          'data-icon' => 'plus', 'data-iconpos' => 'notext'
      -# = link_to "#{@total_completed} today, #{@velocity} avg.", root_path
      = render :partial => 'stats_grid', :locals => { :history => @history }
    - unless @important_tasks.empty?
      %ul{ :data => { :role => "listview", :inset => 'true',
        'split-icon' => 'gear' } }
        - current_date = nil
        - @important_tasks.each do |task|
          - if task.deadline?
            - if (current_date == nil) || (current_date != task.deadline.to_s(:date))
              %li{ :data => { :role => "list-divider" } }= task.deadline.to_s(:date)
              - current_date = task.deadline.to_s(:date)
          = render :partial => 'tasks/task', :locals => { :task => task }
    %ul{ :data => { :role => "listview", :inset => 'true',
      'split-icon' => 'gear' } }
      = render @goals
      %li{ :data => { :theme => 'b', :icon => 'plus' } }
        = link_to "Add Goal", new_goal_path, :data => { :ajax => 'false' }
  %ul{ :data => { :role => "listview", :inset => 'true' } }
    %li{ :data => { :theme => 'b' } } Configure
    %li= link_to "User Settings", edit_user_path(current_user)
    %li= link_to "Sign Out", signout_path, :confirm => "Are you sure you want to sign out?"
